{% extends 'practice/base.html' %}

{% block title %}Import Data - Law Firm Practice Management{% endblock %}

{% block content %}
<h1>Import Data</h1>

<div class="card">
    <h2>Upload Files for Import</h2>
    <p style="margin-bottom: 1.5rem;">Upload CSV, JSON, or Excel files containing client, attorney, matter, or time tracking data. The system will automatically detect the format and import the data.</p>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <div style="margin-bottom: 1.5rem;">
            <label for="id_files" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">{{ form.files.label }}</label>
            <input type="file" name="files" id="id_files" multiple accept=".csv,.json,.xlsx" style="display: block; padding: 0.5rem; border: 2px dashed #cbd5e0; border-radius: 4px; width: 100%; background: #f7fafc;">
            <small style="color: #666; display: block; margin-top: 0.5rem;">{{ form.files.help_text }}</small>
        </div>

        <button type="submit" style="background: #2563eb; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; font-weight: 600;">
            Upload and Start Import
        </button>
    </form>
</div>

{% if recent_jobs %}
<div class="section">
    <h2>Recent Import Jobs</h2>
    <div class="card">
        <table>
            <thead>
                <tr>
                    <th>Job ID</th>
                    <th>Status</th>
                    <th>Files</th>
                    <th>Records Imported</th>
                    <th>Errors</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for job in recent_jobs %}
                <tr>
                    <td>#{{ job.id }}</td>
                    <td><span class="badge badge-{{ job.status }}">{{ job.get_status_display }}</span></td>
                    <td>{{ job.files_uploaded }}</td>
                    <td>{{ job.records_imported }}</td>
                    <td>{{ job.errors_count }}</td>
                    <td>{{ job.created_at|date:"M d, Y H:i" }}</td>
                    <td><a href="{% url 'import_monitor' job.id %}" class="link">Monitor</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<div class="section">
    <h2>Sample Import Files</h2>
    <div class="card">
        <p>Need sample files to test? Check the <code>sample_imports/</code> directory for example files with intentional challenges:</p>
        <ul style="margin-left: 1.5rem; line-height: 2;">
            <li><strong>clients_onboarding.csv</strong> - Multiple date formats, duplicate detection</li>
            <li><strong>attorneys_import.csv</strong> - Different column name variations</li>
            <li><strong>matters.csv</strong> - Missing foreign key references</li>
            <li><strong>time_tracking_Q1.csv</strong> - Time entries with attorney IDs</li>
            <li><strong>time_tracking_Q2.csv</strong> - Time entries with attorney names (different structure)</li>
            <li><strong>billing_info.json</strong> - Invoices and payments in JSON format</li>
        </ul>
    </div>
</div>
{% endblock %}
